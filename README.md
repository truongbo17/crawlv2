# CrawlerV2

## Description

* Xây dựng theo <a href="https://gitlab.com/giahao9899/any_crawl_2021">giahao9899/any_crawl_2021</a>
* Note :  
  * Thu thập dữ liệu từ tất cả các website.
  * Khi truy cập vào một url sẽ lấy tất cả những url phù hợp với điều kiện trong config site . Các url sẽ chạy đến khi không còn url nào phù hợp với điều kiện nữa
  * Thu thập dữ liệu theo điều kiện trong config site  
  
## Usage

### Step 1 : Tạo config site

```phpt
<?php

namespace App\Crawler\Sites\Resource;

use App\Crawler\Sites\SiteAbstract;
use Symfony\Component\DomCrawler\Crawler as DomCrawler;

class Job123 extends SiteAbstract
{
    public function startUrls(): array
    {
        // TODO: Implement startUrls() method.
        return ['https://123job.vn'];
    }

    public function shouldCrawl(string $url)
    {
        return preg_match("/^https:\/\/123job\.vn\/(viec-lam|việc-làm|vi%E1%BB%87c-l%C3%A0m)/", $url);
    }

    public function shouldGetData(string $url)
    {
        return preg_match("/^https:\/\/123job\.vn\/viec-lam/", $url);
    }

    public function getInfoFromCrawler(DomCrawler $dom_crawler, string $url = '')
    {
        return parent::getInfoFromCrawler($dom_crawler, $url); // TODO: Change the autogenerated stub
    }
}
```
* Tạo config site trong App\Crawler\Sites\Resource
  * startUrls() : trả về mảng các url trong lần đầu tiên chạy
  * shouldCrawl() : định nghĩa thế nào là url cần truy cập vào
  * shouldGetData() : định nghĩa thế nào là url cần lấy dữ liệu
  * getInfoFromCrawler() : định nghĩa cách lấy dữ liệu

### Step 2 : Khai báo Site

```phpt
 protected static array $sites = [
        'https://123job.vn' => Job123::class,
        'https://journals.plos.org/plosone/browse?page=2' => Journals::class,
 ];
```
* Khai báo site trong App\Crawler\Sites\SiteManager.php

### Step 3 : Chỉ định site muốn crawl

```phpt
$crawler->run('https://123job.vn');
```
* Site được chỉ định phải match với cả site được khai báo

### Step 4 : Chạy crawl

```shell
php artisan crawl:auto
```
